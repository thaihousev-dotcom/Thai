<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF Viewer - Drinks / Kitchen</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #0b0f17;
      color: #fff;
      font-family: system-ui, -apple-system, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 0;
    }

    .topbar {
      width: 100%;
      max-width: 1000px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 0 10px;
      box-sizing: border-box;
      margin-bottom: 14px;
    }

    .tabs {
      display: inline-flex;
      gap: 8px;
      background: rgba(255,255,255,0.06);
      padding: 6px;
      border-radius: 14px;
    }

    .tab-btn {
      border: 0;
      cursor: pointer;
      color: #fff;
      background: transparent;
      padding: 8px 12px;
      border-radius: 10px;
      font-size: 14px;
      opacity: 0.8;
    }

    .tab-btn.active {
      background: rgba(255,255,255,0.12);
      opacity: 1;
    }

    #status {
      font-size: 14px;
      opacity: 0.85;
      white-space: nowrap;
    }

    .viewer {
      width: 100%;
      max-width: 1000px;
    }

    .pdf-container {
      display: none; /* only one is shown */
      flex-direction: column;
      gap: 20px;
      width: 100%;
      align-items: center;
    }

    .pdf-container.active {
      display: flex;
    }

    canvas {
      max-width: 95%;
      height: auto !important;
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
      background: white;
      border-radius: 6px;
    }
  </style>
</head>

<body>

  <div class="topbar">
    <div class="tabs" role="tablist" aria-label="Menu PDFs">
      <button id="tab-drinks" class="tab-btn active" role="tab" aria-selected="true">
        Drinks
      </button>
      <button id="tab-kitchen" class="tab-btn" role="tab" aria-selected="false">
        Kitchen
      </button>
    </div>

    <div id="status">Loading…</div>
  </div>

  <div class="viewer">
    <div id="pdf-drinks" class="pdf-container active"></div>
    <div id="pdf-kitchen" class="pdf-container"></div>
  </div>

  <script>
    // PDF.js
    const pdfjsLib = window["pdfjs-dist/build/pdf"];
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

    /* ======== PDF PATHS ======== */
    const PDFS = {
      drinks: "done.pdf",
      kitchen: "KITCHEN.pdf",
    };
    /* =========================== */

    const statusEl = document.getElementById("status");

    const containers = {
      drinks: document.getElementById("pdf-drinks"),
      kitchen: document.getElementById("pdf-kitchen"),
    };

    const tabs = {
      drinks: document.getElementById("tab-drinks"),
      kitchen: document.getElementById("tab-kitchen"),
    };

    // Cache loaded PDFs so switching is instant
    const pdfCache = new Map(); // key -> pdfDoc
    let activeKey = "drinks";
    let renderToken = 0; // cancellation token

    function setStatus(text) {
      statusEl.textContent = text;
    }

    function setActiveTab(key) {
      activeKey = key;

      // buttons
      for (const k of Object.keys(tabs)) {
        const isActive = k === key;
        tabs[k].classList.toggle("active", isActive);
        tabs[k].setAttribute("aria-selected", String(isActive));
      }

      // containers
      for (const k of Object.keys(containers)) {
        containers[k].classList.toggle("active", k === key);
      }
    }

    function clearContainer(el) {
      // remove canvases
      while (el.firstChild) el.removeChild(el.firstChild);
    }

    async function getPdfDoc(key) {
      if (pdfCache.has(key)) return pdfCache.get(key);

      const loadingTask = pdfjsLib.getDocument(PDFS[key]);
      const pdfDoc = await loadingTask.promise;
      pdfCache.set(key, pdfDoc);
      return pdfDoc;
    }

    async function renderAllPages(pdfDoc, containerEl, token) {
      const numPages = pdfDoc.numPages;

      for (let i = 1; i <= numPages; i++) {
        // cancel if user switched tab mid-render
        if (token !== renderToken) return;

        setStatus(`Rendering page ${i}/${numPages}…`);
        const page = await pdfDoc.getPage(i);

        // Scale 1.5: quality. Set to 1.0 if slow.
        const viewport = page.getViewport({ scale: 1.5 });

        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d", { alpha: false });

        canvas.width = viewport.width;
        canvas.height = viewport.height;

        containerEl.appendChild(canvas);

        await page.render({ canvasContext: ctx, viewport }).promise;
      }

      if (token === renderToken) {
        setStatus(`Done (${numPages} pages)`);
        setTimeout(() => {
          // hide status only if still same token (still same view)
          if (token === renderToken) setStatus("");
        }, 1200);
      }
    }

    async function showPdf(key) {
      setActiveTab(key);

      const token = ++renderToken;
      const containerEl = containers[key];

      // Always clear before rendering to avoid duplicates
      clearContainer(containerEl);

      try {
        setStatus("Loading PDF…");
        const pdfDoc = await getPdfDoc(key);

        // if switched while loading
        if (token !== renderToken) return;

        setStatus(`Total pages: ${pdfDoc.numPages}`);
        await renderAllPages(pdfDoc, containerEl, token);
      } catch (err) {
        console.error(err);
        if (token !== renderToken) return;
        setStatus("Load error: " + (err?.message || String(err)));
      }
    }

    // Tab handlers
    tabs.drinks.addEventListener("click", () => showPdf("drinks"));
    tabs.kitchen.addEventListener("click", () => showPdf("kitchen"));

    // Initial load
    showPdf("drinks");
  </script>

</body>
</html>
